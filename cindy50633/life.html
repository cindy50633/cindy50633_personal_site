<script language="JavaScript">
M = 64;
N = 64;
SpeedFast = 50;
SpeedSlow = 100;

p = new Array(M * N + 1);
q = new Array(M * N + 1);
isRunning = false;
Speed = SpeedSlow;
timerID = null;

function angel(x, y, n) {
  if (x == 0) {
    if (y == 0) {
      sum = p[1] + p[N] + p[N + 1];
    } else if (y == N - 1) {
      sum = p[N - 2] + p[N + N - 2] + p[N + N - 1];
    } else {
      sum = p[y-1]              + p[y+1]
          + p[N + (y-1)] + p[N + y] + p[N + (y+1)];
    }
  } else if (x == M - 1) {
    if (y == 0) {
      sum = p[(M-2) * N] + p[(M-2) * N + 1] + p[x * N + 1];
    } else if (y == N - 1) {
      sum = p[M * N - N -2] + p[M * N - N - 1] + p[M * N - 2];
    } else {
      sum = p[(M-2) * N + (y-1)] + p[(M-2) * N + y] + p[(M-2) * N + (y+1)]
          + p[x * N + (y-1)]              + p[x * N + (y+1)];
    }
  } else {
    if (y == 0) {
      sum = p[(x-1) * N] + p[(x-1) * N + 1] + p[x * N + 1]
           + p[(x+1) * N] + p[(x+1) * N + 1];
    } else if (y == N - 1) {
      sum = p[(x-1) * N + (y-1)] + p[(x-1) * N + y] + p[x * N + (y-1)]
          + p[(x+1) * N + (y-1)] + p[(x+1) * N + y] ;
    } else {
      sum = p[(x-1) * N + (y-1)] + p[(x-1) * N + y] + p[(x-1) * N + (y+1)]
          + p[x * N + (y-1)]              + p[x * N + (y+1)]
          + p[(x+1) * N + (y-1)] + p[(x+1) * N + y] + p[(x+1) * N + (y+1)];
    }
  }

  if ((p[n] == 0) && (sum == 3))
    return 1;
  if ((p[n] == 1) && (sum == 2 || sum == 3))
    return 1;
  return 0;
}

function god() {
  n = 0;
  for (x = 0; x < M; x++) {
    for (y = 0; y < N; y++) {
      q[n] = angel(x, y, n);
      if (p[n] != q[n])
        document.images[n].src = "i" + q[n] + ".gif";
      n++;
    }
  }
}

function draw(n) {
  p[n] = p[n]^1;
  document.images[n].src = "i" + p[n] + ".gif";
}

function reDraw() {
  for (n = 0; n < N * M; n++) {
    if (document.images[n].src != "i" + p[n] + ".gif")
      document.images[n].src = "i" + p[n] + ".gif";
  }
  return;
}

function ClearArray() {
  isRunning = false;
  for (n = 0; n < M * N; n++) {
      p[n] = 0;
  }
  life.btn1.value = "うごく";
}

function ClearAll() {
  isRunning = false;
  for (n = 0; n < M * N; n++) {
    if (p[n] == 1) {
      p[n] = 0;
      document.images[n].src = "i0.gif";
    }
  }
  life.btn1.value = "うごく";
}

function stepRun() {
  god();
  for (n = 0; n < N * M; n++)
    p[n] = q[n];
  return;
}

function stepRun1(form) {
  stop(form);
  stepRun();
  return;
}

function loop() {
  if (!isRunning)
    return;
  stepRun();
  setTimeout("loop()", Speed);
  return;
}

function move(form) {
  isRunning = true;
  form.btn1.value = "とまる";
  loop();
}

function stop(form) {
  isRunning = false;
  form.btn1.value = "うごく";
  return;
}

function change1(form) {
  if (isRunning == false) {
    move(form);
  } else {
    stop(form);
  }
}

function change2(form) {
  if (Speed == SpeedSlow) {
    Speed = SpeedFast;
    form.btn2.value = "おそく";
  } else {
    Speed = SpeedSlow;
    form.btn2.value = "はやく";
  }
}

function initialize() {
  n = 0;
  for (x = 0; x < M; x++) {
    for(y = 0; y < N; y++) {
      document.write('<a href="JavaScript:draw(' + n + ')"><img src = i0.gif border=0></a>');
      n++;
    }
  document.write("<br>");
  }
  ClearAll();
  stepRun();
}

// 初期配置
function glider() {
  ClearArray();
  p[2 * N + 4] = 1; p[3 * N + 5] = 1; p[4 * N + 3] = 1;
  p[4 * N + 4] = 1; p[4 * N + 5] = 1;
  reDraw();
}

function glider2() {
  ClearArray();
  p[2 * N + 2] = 1; p[2 * N + 5] = 1; p[3 * N + 6] = 1;
  p[4 * N + 2] = 1; p[4 * N + 6] = 1;
  p[5 * N + 3] = 1; p[5 * N + 4] = 1; p[5 * N + 5] = 1; p[5 * N + 6] = 1;
  reDraw();
}

function genglider() {
  ClearArray();
  p[3 * N + 27] = 1; p[4 * N + 25] = 1; p[4 * N + 27] = 1;
  p[5 * N + 15] = 1; p[5 * N + 16] = 1; p[5 * N + 23] = 1;
  p[5 * N + 24] = 1; p[5 * N + 37] = 1; p[5 * N + 38] = 1;
  p[6 * N + 14] = 1; p[6 * N + 18] = 1; p[6 * N + 23] = 1;
  p[6 * N + 24] = 1;p[6 * N + 37] = 1;
  p[6 * N + 38] = 1; p[7 * N + 3] = 1; p[7 * N + 4] = 1;
  p[7 * N + 13] = 1; p[7 * N + 19] = 1; p[7 * N + 23] = 1;
  p[7 * N + 24] = 1; p[8 * N + 3] = 1; p[8 * N + 4] = 1;
  p[8 * N + 13] = 1; p[8 * N + 17] = 1; p[8 * N + 19] = 1;
  p[8 * N + 20] = 1; p[8 * N + 25] = 1; p[8 * N + 27] = 1; p[9 * N + 13] = 1;
  p[9 * N + 19] = 1; p[9 * N + 27] = 1; p[10 * N + 14] = 1;
  p[10 * N + 18] = 1; p[11 * N + 15] = 1; p[11 * N + 16] = 1;
  reDraw();
}

function line10() {
  ClearArray();
  for (i = 0; i < 10; i++)
    p[5 * N + 5 + i] = 1;
  reDraw();
}

function queenbee() {
  ClearArray();
  p[4 * N + 15] = 1; p[5 * N + 14] = 1; p[5 * N + 15] = 1;
  p[6 * N + 13] = 1; p[6 * N + 14] = 1; p[6 * N + 19] = 1;
  p[6 * N + 20] = 1; p[7 * N + 3] = 1; p[7 * N + 4] = 1;
  p[7 * N + 12] = 1; p[7 * N + 13] = 1; p[7 * N + 14] = 1;
  p[7 * N + 19] = 1; p[7 * N + 20] = 1; p[7 * N + 23] = 1;
  p[7 * N + 24] = 1; p[8 * N + 3] = 1; p[8 * N + 4] = 1;
  p[8 * N + 13] = 1; p[8 * N + 14] = 1; p[8 * N + 19] = 1;
  p[8 * N + 20] = 1; p[8 * N + 23] = 1; p[8 * N + 24] = 1;
  p[9 * N + 14] = 1; p[9 * N + 15] = 1; p[10 * N + 15] = 1;
  reDraw();
}

function nebura() {
  ClearArray();
  for (i = 0; i < 6; i++) {
    p[4 * N + 4 + i] = 1;
    p[5 * N + 4 + i] = 1;
    p[(4 + i) * N + 11] = 1;
    p[(4 + i) * N + 12] = 1;
    p[11 * N + 7 + i] = 1;
    p[12 * N + 7 + i] = 1;
    p[(7 + i) * N + 4] = 1;
    p[(7 + i) * N + 5] = 1;
  }
  reDraw();
}

</script>
